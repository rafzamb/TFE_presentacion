---
title: "Predicción de ocurrencia de delitos MRG"
subtitle: "Implementación de modelos predictivos en base a los casos registrados en CABA durante el periodo 2017-2019"
author: "Rafael Zambrano"
institute: "Universidad de Buenos Aires, Facultad de Ciencias Economicas, ENAP"
date: "2021/11/23"
output:
  xaringan::moon_reader:
    seal: false
    css: xaringan-themer.css
    nature:
      countIncrementalSlides: false
      navigation: 
        scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      comment=FALSE)
```

```{r ,echo=FALSE}
library(tidyverse)
library(lubridate)
```


class: center

```{r xaringan-themer, include=FALSE, warning=FALSE, eval=FALSE}
library(xaringanthemer)
#style_mono_light(base_color = "#23395b")
#style_duo_accent(primary_color = "#FFFFFF", secondary_color = "#FA795E")
style_duo_accent(primary_color = "#FA795E",
                 secondary_color = "#FFFFFF",
                 header_h1_font_size = "1.8rem",
                 header_h2_font_size = "1.5rem",
                 header_h3_font_size = "1.0rem"
                 )
#style_duo_accent_inverse(primary_color = "#FFFFFF", secondary_color = "#FA795E")
#style_duo_accent_inverse(primary_color = "#FA795E", secondary_color = "#FFFFFF")
```


```{r, echo=FALSE}
knitr::include_graphics('fondo_fce.png')
```

<br>
<br>
<br>
<br>

 <font size="10"> MRG: Trabajo Práctico Final</font> 

<br>
<br>

#### 2021-11-23

#### Rafael Zambrano
---
class: center

```{r, echo=FALSE}
knitr::include_graphics('fondo_fce.png')
```

<br>
<br>
<br>

## Análisis de ocurrencia delictiva en las esquinas de CABA, casos registrados durante el periodo 2017-2019

<br>

#### Rafael Zambrano

---
# Resumen

🔸 El foco principal de este estudio, reside en contextualizar la problemática de la criminalidad en la ciudad de Buenos Aires, con base en los casos registrados entre los años 2017 y 2019. Relacionando las esquinas de la ciudad con los elementos de entorno cercano a la ocurrencia del delito.


---

# Problemática

🔸 La ocurrencia de delitos es un fenomeno de índole social y económico, dado lo amplio y transversal que resulta estudiar este tópico, se pretende abordar el tema mediante una relación funcional entre la problemática y los **"elementos de entorno"**. 

--

🔸 Se busca implementar modelos de regresión que permitan predecir la ocurrencia de delitos en un conjunto de esquinas de CABA, además, se pretende estimar la influencia de los elementos de entorno en la criminalidad.

--

🔸 ¿Cómo puede relacionarse el entorno geográfico y la ocurrencia delictiva, mediante modelos de regresión de coneto?

<br>

---

# Conjunto de Datos

* **Fuente de datos**

🔸 Los datos brutos se extraen del repositorio del Gobierno de la Ciudad Autónoma de Buenos Aires (GCABA). [Repositorio del GCABA](https://data.buenosaires.gob.ar/dataset/).

--

* **Principales componentes de los datos**

🔸 Los datos tienen dos componentes fundamentales, el primero hace referencia a la geolocalización, siendo representado por la longitud y latitud en cada conjunto de datos. 

🔸 El segundo componente es el tiempo, que está presente en los delitos ocurridos y en los factores meteorológicos. 

---

# Distribución geográfica de los delitos registrados**

<br>

```{r, echo=FALSE, fig.align='center', out.width='70%', out.height='70%'}

Data_set_modelos <- readRDS("Data_set_modelos.rds")

dataset <- Data_set_modelos %>% 
  filter(pliegue == 24) %>% 
  select(-c(pliegue, delitos_next_3))


my_map_heat = function (data, pts = NULL,opacity = 0.01, radius = 0.1) {
  if (is.null(pts)) {
    pts <- TRUE
  }
  if (!is.logical(pts)) {
    stop("pts must be specified as boolean: TRUE or FALSE")
  }
  lat <- as.numeric(data$lat)
  lon <- as.numeric(data$long)
  bwlat <- stats::bw.nrd0(lat)
  bwlon <- stats::bw.nrd0(lon)
  kde <- KernSmooth::bkde2D(cbind(lon, lat), bandwidth = c(bwlon, 
                                                           bwlat), gridsize = c(100, 100))
  CL <- grDevices::contourLines(kde$x1, kde$x2, kde$fhat)
  LEVS <- as.factor(sapply(CL, `[[`, "level"))
  NLEV <- length(levels(LEVS))
  pgons <- lapply(1:length(CL), function(i) sp::Polygons(list(sp::Polygon(cbind(CL[[i]]$x, 
                                                                                CL[[i]]$y))), ID = i))
  spgons = sp::SpatialPolygons(pgons)
  if (isTRUE(pts)) {
    map <- leaflet::leaflet(data) %>% 
      leaflet::addTiles() %>% 
      leaflet::addPolygons(data = spgons, color = grDevices::heat.colors(NLEV, NULL)[LEVS]) %>% 
      leaflet::addCircles(lon, lat, color = "purple",opacity = opacity, radius = radius)
  }
  else {
    map <- leaflet::leaflet(data) %>% 
      leaflet::addTiles() %>% 
      leaflet::addPolygons(data = spgons, color = grDevices::heat.colors(NLEV, 
                                                                         NULL)[LEVS]) 
    
  }
  return(map)
}


delitos <- readRDS("delitos.rds")

delitos %>% 
  
  filter(fecha >= "2019-12-01" & fecha <= "2020-01-01") %>%
  
  mutate(across(c(lat,long), ~ ifelse(.x < -100, .x/1000 ,.x))) %>% 
  
  my_map_heat(pts = TRUE)
```

---

# Conjunto de Datos

Son seleccionadas 1246 esquinas de CABA, indexando elementos de entono fisico y temporlaes para el mes de diciembre del año 2019.

--

## 🔸 Elementos de entorno  físico 🌎

Dentro de estos elementos se mencionan algunos como locales bailables, estaciones de metro, comisarías de policía, estaciones de servicio, embajadas, cines, entre otros. 

---
# Transformación y limpieza de datos

🔸 El dataset cuenta con 49 columnas y 1246 observaciones, las columnas agrupan las variables de entorno y el historial de delitos ocurridos.

--

```{r ,eval=FALSE}
dataset %>% head()
```


```{r ,echo=FALSE}
dataset %>% 
  head() %>% 
  rmarkdown::paged_table(list(rows.print = 6))
```

---
# Análisis exploratorio de datos


```{r, echo=FALSE}
tab = table(dataset$delitos)
tab = as.data.frame(tab)

ggplot(tab,aes(x=Var1,y=Freq)) + geom_col() + theme_minimal() +
  ggtitle("Dsitribución de la ocurrencia de delitos") +
  ylab("Númro de esquinas") +
  xlab("Número de delitos")

```


---
# Análisis exploratorio de datos


```{r ,echo=FALSE}
library(tidyverse)
library(skimr)
library(tidymodels)

Receta <- recipe(delitos ~ ., data = dataset) %>% 
  
  step_mutate(bancos = atm + bancos) %>% 
  
  step_select(-atm) %>% 
  
  step_nzv(all_predictors(), freq_cut = 75/25)


dataset_def <- Receta %>% prep() %>% bake(dataset)

prueba <- dataset_def %>% select(delitos,
                                 bancos                             ,
                                 meses_sin_delitos                  ,
                                 colectivo                          ,
                                 garajes                            ,
                                 educativos                         )


prueba %>% skim_without_charts() %>% yank("numeric")
```

